/*
 * Receiver
 *
 *  Created on: Sep 5, 2023
 *  Author: Abdelrahman Hamdy
 */

#include "Func_main.h"

u8 G_WrongTrial=0;

int main(){

	HLCD_VoidInit();
	MUART_VoidInit();
	HKPD_VoidInit();
	u8 Received_Key;

while(1)
{
	u8 Bool1=0;
	Received_Key = MUART_u8Receive();

	if(Received_Key == 'M')
	{
		HLCD_VoidClear();
		HLCD_VoidSendString("Enter password");
		HLCD_VoidCursor(0,LINE1);
		HLCD_VoidSendString("to pass Amr");
		_delay_ms(1000);


		for(u8 i =0 ; i<3;i++)
		{
			Bool1=CheckPassword();
			if (Bool1)
			{
				MUART_VoidTransmit('P');
				break;
			}
		}
		if (!Bool1 )
		{
			MUART_VoidTransmit('X');
		}
	}
	else if(Received_Key == 'B')
	{
		HLCD_VoidClear();
		HLCD_VoidSendString("Enter password");
		HLCD_VoidCursor(0,LINE1);
		HLCD_VoidSendString("to pass");
		_delay_ms(1000);

		HLCD_VoidClear();
		HLCD_VoidSendString("to pass");
		HLCD_VoidCursor(0,LINE1);
		HLCD_VoidSendString("Abdelrahman");
		_delay_ms(1000);



		for(u8 i =0 ; i<3;i++)
		{
			Bool1=CheckPassword();
			if (Bool1)
			{
				MUART_VoidTransmit('P');
				break;
			}
		}
		if (!Bool1 )
		{
			MUART_VoidTransmit('X');
		}

	}
	else if(Received_Key == 'W')
	{
		HLCD_VoidClear();
		HLCD_VoidSendString("Enter password");
		HLCD_VoidCursor(0,LINE1);
		HLCD_VoidSendString("to pass Wael");
		_delay_ms(1000);



		for(u8 i =0 ; i<3;i++)
		{
			Bool1=CheckPassword();
			if (Bool1)
			{
				MUART_VoidTransmit('P');
				break;
			}
		}
		if (!Bool1 )
		{
			MUART_VoidTransmit('X');
		}
	}
	else if(Received_Key == 'D')
	{
		HLCD_VoidClear();
		HLCD_VoidSendString("To allow access");
		HLCD_VoidCursor(0,LINE1);
		HLCD_VoidSendString("enter password");
		_delay_ms(1500);


		for(u8 i =0 ; i<3;i++)
		{
			Bool1=CheckPassword();
			if (Bool1)
			{
				MUART_VoidTransmit('A');
				break;
			}
		}
		if (!Bool1 )
		{
			MUART_VoidTransmit('X');
		}


	}
	else if(Received_Key == 'C')
	{
		HLCD_VoidClear();
		HLCD_VoidSendString("Someone is ");
		HLCD_VoidCursor(0,LINE1);
		HLCD_VoidSendString("trying to enter");

	}


}

return 0;}

u16 GetNumber()
{
	u16 L_Number=0;
	u8 L_PressedKey=0;

	L_PressedKey=HKPD_u8GetPressedKey();
	while(L_PressedKey == '*' || L_PressedKey == '#' )
	{
		L_PressedKey=HKPD_u8GetPressedKey();
	}
	HLCD_VoidSendData(L_PressedKey);
	L_Number = (L_PressedKey-'0')*1000;


	L_PressedKey=HKPD_u8GetPressedKey();
	while(L_PressedKey == '*' || L_PressedKey == '#' )
	{
		L_PressedKey=HKPD_u8GetPressedKey();
	}
	HLCD_VoidSendData(L_PressedKey);
	L_Number += ((L_PressedKey-'0')*100);

	L_PressedKey=HKPD_u8GetPressedKey();
	while(L_PressedKey == '*' || L_PressedKey == '#' )
	{
		L_PressedKey=HKPD_u8GetPressedKey();
	}
	HLCD_VoidSendData(L_PressedKey);
	L_Number += ((L_PressedKey-'0')*10);


	L_PressedKey=HKPD_u8GetPressedKey();
	while(L_PressedKey == '*' || L_PressedKey == '#' )
	{
		L_PressedKey=HKPD_u8GetPressedKey();
	}
	HLCD_VoidSendData(L_PressedKey);
	L_Number += (L_PressedKey-'0');

	return L_Number;
}

u8 CheckID()
{
	u16 L_ID, id1=1234, id2=5678, id3=7891;

	HLCD_VoidClear();
	HLCD_VoidSendString("Please enter ID:");
	HLCD_VoidCursor(0,LINE1);
	L_ID=GetNumber();

	if		( L_ID==id1 )	{	return 1;	}
	else if	( L_ID==id2 )	{	return 2;	}
	else if ( L_ID==id3 )	{	return 3;	}
	else
	{
		_delay_ms(500);
		HLCD_VoidClear();
		HLCD_VoidSendString("Wrong ID");
		_delay_ms(1500);

		return 0;
	}

}

u8 CheckPassword(  )
{
	u16 ADMIN=9999;

	u16 L_Pass;

	HLCD_VoidClear();
	HLCD_VoidSendString("Enter Password:");
	HLCD_VoidCursor(0,LINE1);
	L_Pass=GetNumber();

	if		(ADMIN == L_Pass)	{	return 1;	}

	else
	{
		HLCD_VoidClear();
		HLCD_VoidSendString("Wrong password");

		_delay_ms(1000);

		return 0;
	}


}
